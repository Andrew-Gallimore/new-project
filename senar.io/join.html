<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" id="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    
    <title>Senario Mini-Games</title>
    <link rel="icon" type="image/png" href="/senar.io/Uni/Favicon.png" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.1.9/lib/p5.js"></script>
    <script async src="//cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js" onload="initFingerprintJS()" ></script>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Assistant&family=Gabriela&display=swap" rel="stylesheet">
</head>
<style>
    * {
        margin: 0 0;
        padding: 0 0;
    }

    button,
    input[type="submit"],
    input[type="reset"],
    input[type="text"],
    input[type="password"] {
        background: none;
        color: inherit;
        border: none;
        padding: 0;
        font: inherit;
        cursor: pointer;
        outline: inherit;
    }

    body {
        background: #313131;
        background-image: linear-gradient(to bottom right, #434343, #262626);
        background-image: url("/senar.io/assets/Artwork_Map.png");
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center;
        font-family: 'Assistant', sans-serif;
        font-weight: 600;
        overflow-x: hidden;
    }

    .main {
        height: 100vh;
        width: 100vw;
        display: flex;
        align-items: center;
        flex-direction: column;
        overflow-x: hidden;
    }

    /* previous stuff */

    .main .bottom {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        display: none;
        position: absolute;
        bottom: 3vh;
    }

    .main .bottom h2 {
        margin-top: 30px;
        font-family: 'Assistant', sans-serif;
        font-size: 0.9rem;
        font-weight: 300;
        text-align: center;
        width: 70%;
    }

    .main .bottom a {
        margin-top: 7px;
        border: solid #000000 1px;
        border-radius: 7px;
        padding: 3px 6px;
        font-size: 1rem;
        color: #000000;
        font-family: 'Gabriela', serif;
        text-decoration: none;
        box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.672);
        transition: 0.4s;
    }
    .main .bottom a:hover {
        padding: 3px 10px;
        transform: translateY(-2px);
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.672);
    }

    .bottom2 {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        display: none;
    }
    .bottom2 h2 {
        margin-top: 20px;
        font-family: 'Gabriela', serif;
        font-size: 2rem;
        text-align: center;
        width: 70%;
        color:  #d8f13c;
    }
    .bottom2 h3 {
        font-family: 'Assistant', sans-serif;
        font-weight: 600;
        font-size: 1rem;
        text-align: center;
        width: max-content;
        transform: translateX(100px) rotate(-6deg);
        color: #e9e9e9;
    }
    .bottom2 button {
        font-family: 'Assistant', sans-serif;
        font-size: 1rem;
        color: #22d2ff;
        text-decoration: underline;
    }

    @media (min-aspect-ratio: 10/7) {
        .bg1 {
            width: auto;
            height: 60vh;
        }
    }

    @media (max-aspect-ratio: 10/7) {
        .bg1 {
            width: 110vw;
            height: 77vw;
        }
    }

    /* Add Zoom Animation */
    .animate {
    -webkit-animation: animatezoom 0.6s;
    animation: animatezoom 0.6s
    }
    .animate-delay {
    -webkit-animation: animatezoom 0.6s;
    -webkit-animation-delay: 0.3s;
    -webkit-animation-fill-mode: both;
    animation: animatezoom 0.6s;
    animation-delay: 0.3s;
    animation-fill-mode: both;
    }

    @-webkit-keyframes animatezoom {
    from {-webkit-transform: scale(0)} 
    to {-webkit-transform: scale(1)}
    }
    @keyframes animatezoom {
    from {transform: scale(0)} 
    to {transform: scale(1)}
    }

    .fade {
    -webkit-animation: fadeing 1s;
    -webkit-animation-delay: 0.7s;
    animation: fadeing 1s;
    animation-delay: 0.7s;
    animation-fill-mode: forwards;
    }

    @-webkit-keyframes fadeing {
    0% {opacity: 1;} 
    99% {opacity: 0.01;}
    100% {opacity: 0;}
    }
    @keyframes fadeing {
    0% {opacity: 1;} 
    99% {opacity: 0.01;}
    100% {opacity: 0;}
    }

    .w-12 {
        width: 80%;
    }

    .title2 {
        margin-top: 5vh;
        height: max-content;
        width: 100%;
        position: relative;
    }
    .title2 .container-bg {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
    }
    .title2 .container-bg img {
        width: 100%;
        max-width: 740px;
        height: fit-content;
        max-height: 170px;
    }

    .search {
        background: white;
        position: absolute;
        padding: 20px;
        bottom: 5vh;
        width: 90%;
        max-width: 740px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .search .container-bg {
        position: absolute;
    }
    .search .form {
        position: absolute;
        display: flex;
        flex-direction: column;
    }
    .search .a {
        position: relative;
        display: grid;
        grid-template-columns: max-content 8% auto;
        width: 100%;
        height: 2rem;
    }
    .search .space {
        height: 30px;
    }
    .search .a .enter-area i {
        transform: translateY(-3px);
    }
    .search .a .enter-area input {
        text-transform: uppercase;
    }
    .search .b {
        position: relative;
        display: grid;
        grid-template-columns: 50% auto 50%;
        width: 100%;
        height: 2rem;
    }
    .search .b .area-left,
    .search .b .area-right {
        width: 50%;
        display: grid;
        grid-template-columns: max-content 8% auto;
        width: 100%;
        height: 2rem;
    }
    .search .z {
        margin-top: 28px;
        margin-left: auto;
        margin-right: auto;
        width: fit-content;
        text-align: center;
    }
    .search .z .text {
        padding: 8px 20px;
    }
    .search .z .text {
        border-radius: 5px;
        box-shadow: rgba(0, 0, 0, 0.501) 3px 2px 7px;
        pointer-events: none;
        transition: all 0.3s ease-out;
        border: solid rgba(0, 0, 0, 0.049) 0.5px;
    }
    .search .z button:hover div {
        transform: translateY(-5px);
        box-shadow: rgba(0, 0, 0, 0.501) 5px 9px 9px;
        border: solid rgba(0, 0, 0, 0.268) 0.5px;
    }

    .search .z .message {
        opacity: 0;
    }

    @media (max-height: 525px) {
        .search {
            position: relative;
            margin-top: 100px;
        }
    }

</style>

<script>
    console.log('Client: Started Javascript');
    var socket = io();
    var IDsent = false;
    var user;
    var userSelect = 1;
    var userTotal = 0; //meaning there is one person, just slot 0
    var pastCode;

    function checkform() {
        if(document.getElementById('error').style.display === '' || document.getElementById('error').style.display === "none") {
            var code = document.getElementById('code');

            if(pastCode === code.value && code.value.length < 6 && code.value != null) {
                var origenal = document.getElementById('error').innerHTML;
                document.getElementById('error').innerHTML = "Still " + origenal.toLowerCase();
                document.getElementById('error').style.display="block";
                setTimeout(function () {
                    document.getElementById('error').innerHTML = origenal;
                    document.getElementById('error').style.display="none";
                }, 1700);
            }
            if(code.value.length > 0 && code.value.length < 6 && code.value != null && pastCode !== code) {
                socket.emit('server', code.value);
            }
            pastCode = code.value;
            console.log(document.getElementById('error').style.display);
        }
        return false;
    }
    //reciveing server message
    socket.on('serverTrue', function(data) {
        storeItem('chrome:Q9fNEdb_tempKey', {
            5977398352: data,
            0462107376: new Date().getTime(),
        });

        console.log(user)
        console.log(user !== undefined)
        if(user !== false && user !== undefined) {
            storeItem('lastUser', { 
                user: user[userSelect].username
            });
        }else {
            storeItem('lastUser', { 
                user: ""
            });
        }
        window.open('senar.io/new/index.html', '_blank');
    });
    socket.on('serverFail', function() {
        document.getElementById('error').style.display="block";
        setTimeout(function () {
            document.getElementById('error').style.display="none";
        }, 2000);
    });
    

    //hideing the sign in pop up if you click outside the sign in pop up
    function hide() {
        var modal = document.querySelector('#sign-in_wrapper');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    //getting my socket id
    var socketID;
    socket.on('connect', function () {
        socketID = socket.id;
        console.log('Server: You have a socket ID registered');
    });

    //reciveing server message
    socket.on('serverMsg', function (data) {
        console.log('Server: ' + data.msg);
    });

    //setting up user data from auto log in
    socket.on('userData', function (data) {
        // document.querySelector(".bottom").style.display="none";
        // document.querySelector(".bottom2").style.display="flex";
        // document.querySelector(".bottom2 h2").innerHTML = data[userSelect].fname + " " + data[userSelect].lname.charAt(0).toUpperCase() + ". !";
        // document.querySelector(".bottom2 h3").innerHTML = "(" + data[userSelect].username + ")";
        user = data;
    });
    //if your auto log in failed
    socket.on('userFail', function () { 
        console.log("Auto Log in failed (from server) ID: " + encript + condencer);
        document.querySelector(".bottom2").style.display="none";
        document.querySelector(".bottom").style.display="flex";
        user = false;
    });

    function mobile() {
        isMobile = true;
        frameRate(24);
    }

    //this is all code that fixes the view height going wonky when in mobile keybord
    var pageInPortraintMode;
    window.addEventListener("resize", windowSizeChanged);
    addEventListener("load", function () {
        pageInPortraintMode = window.innerHeight > window.innerWidth;
        document.getElementById("viewport").setAttribute("content", "width=" + window.innerWidth + ", height=" + window.innerHeight + ", initial-scale=1.0, maximum-scale=1.0, user-scalable=0");
    })
    function windowSizeChanged() {
        if (((pageInPortraintMode === true) && (window.innerHeight < window.innerWidth)) || ((pageInPortraintMode === false) && (window.innerHeight > window.innerWidth))) {
            pageInPortraintMode = window.innerHeight > window.innerWidth;
            document.getElementById("viewport").setAttribute("content", "width=" + window.innerWidth + ", height=" + window.innerHeight + ", initial-scale=1.0, maximum-scale=1.0, user-scalable=0");
        }
    }

    var visitorId;
    var encript;
    var condencer;
    function initFingerprintJS() {
        FingerprintJS.load().then(fp => {
            // The FingerprintJS agent is ready.
            // Get a visitor identifier when you'd like to.
            fp.get().then(result => {
                // This is the visitor identifier:
                visitorId = result.visitorId;
                encript = visitorId.slice(7, 13);
                condencer = visitorId.replace(visitorId.slice(10, 13), "");
            });
        });
    }


        //p5 functions
        function setup() {
            console.log('Client: p5.js: Setup started');
            noCanvas()
        }

        function draw() {
            if(frameCount < 2) {
                console.log('Client: p5.js: Draw started');
            }
            if(millis() > 10000 && user == undefined) {
                console.log("Unable to see if user is able to auto sign-in: Timeout 10s");
                // document.querySelector(".bottom2").style.display="none";
                // document.querySelector(".bottom").style.display="flex";
            }
            // if(socketID !== null && visitorId !== undefined && !IDsent) {
            //     var pack = [];
            //     pack.push({
            //         ID:"" + encript + condencer
            //     });
            //     socket.emit('user', pack);
            //     IDsent = true;
            // }
        }
</script>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div class="main">
        <div class="title2 w-12">
            <div class="container-bg">
                <img src="/senar.io/assets/Boxes.png" alt="Game Title">
            </div>
        </div>
        <div class="search">
            <div class="container-bg">
            </div>
            <form id="form" onSubmit="return checkform()">
                <div class="a">
                    <label for="code">Island Name:</label>
                    <span class="spacer"></span>
                    <div class="enter-area">
                        <i class="fal fa-wifi-1"></i><input type="text" id="code"  name="code" maxlength="5" placeholder=" ex: AZ123" autofocus autocomplete="off">
                    </div>
                </div>
                <div class="space"></div>
                <div class="b">
                    <div class="area-left">
                        <label for="name">Name:</label>
                        <span class="spacer"></span>
                        <div class="enter-area">
                            <input type="text" name="name" maxlength="20" placeholder=" Andrew G." autocomplete="off">
                        </div>
                    </div>
                    <span></span>
                    <div class="area-right">
                        <label for="name">Username:</label>
                        <span class="spacer"></span>
                        <div class="enter-area">
                            <input type="text" name="name" maxlength="20" placeholder=" Runnin123" autocomplete="off">
                        </div>
                    </div>
                </div>
                <hr>
                <div class="z">
                    <div class="animate-delay">
                        <button id="enter"><div class="text">Enter</div></button>
                    </div>
                    <div class="message">
                        <small id="error" class="fade">Not an Island :(</small>
                    </div>
                </div>
            </form>
        </div>
        <!-- <div class="bottom animate">
            <h2>Create your own server for FREE!</h2>
            <a href="/senar.io/view.html" target="_blank">Sign Up</a>
        </div> -->
        <div class="bottom2 animate">
            <h2>Users name</h2>
            <h3>Users username</h3>
            <!-- <button onclick="document.querySelector('#sign-in_wrapper').style.display='flex'">Not you?</button> -->
        </div>
    </div>
</body>

</html>